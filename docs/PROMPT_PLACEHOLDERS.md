# 提示词占位符变量说明

本文档详细说明动画生成系统中各阶段提示词模板可用的占位符变量。

## 占位符格式规范

所有占位符统一使用**双括号格式**：`[[VARIABLE_NAME]]`

> ⚠️ 注意：旧版本中使用过 `{variable}` 格式，现已全部统一为双括号格式。

---

## 各阶段占位符变量

### 1. 剧本解析阶段 (ScriptParse)

**适用提示词：**
- `character_extraction` - 角色提取
- `scene_extraction` - 场景提取

**可用占位符：**

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[SCRIPT]]` | 完整的剧本原文内容 | `# 第一幕\n\n## 场景1：图书馆...` |

---

### 2. 参考图生成阶段 (References)

#### 角色参考图提示词 (character_ref_prompt)

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[NAME]]` | 角色名称 | "小明" |
| `[[DESCRIPTION]]` | 角色外貌描述 | "黑色短发，戴眼镜，穿白色T恤" |
| `[[PERSONALITY]]` | 角色性格 | "内向、文静、喜欢阅读" |
| `[[STYLE]]` | 项目整体风格描述 | "日系动漫风格，新海诚风格" |

#### 场景参考图提示词 (scene_ref_prompt)

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[NAME]]` | 场景名称 | "图书馆，白天" |
| `[[DESCRIPTION]]` | 场景描述 | "阳光透过大窗户洒进来，书架排列整齐" |
| `[[LOCATION]]` | 地点 | "图书馆" |
| `[[TIME]]` | 时间 | "白天" / "夜晚" / "黄昏" |
| `[[STYLE]]` | 项目整体风格描述 | "日系动漫风格，新海诚风格" |

---

### 3. 分镜设计阶段 (Shots)

**适用提示词：**
- `shot_design` - 分镜设计

**可用占位符：**

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[SCENE_NAME]]` | 场景名称 | "图书馆，白天" |
| `[[SCENE_DESCRIPTION]]` | 场景描述 | "阳光透过大窗户洒进来..." |
| `[[CHARACTERS]]` | 角色列表（已格式化） | "- 小明: 黑色短发，戴眼镜\n- 小红: 长发，红色连衣裙" |
| `[[SCRIPT_SEGMENT]]` | 该场景对应的剧本片段 | "小明坐在图书馆靠窗的位置..." |

---

### 4. 首帧生成阶段 (Keyframes)

#### 图片提示词模板 (image_prompt)

用于指导LLM生成每个分镜的图片提示词（正面/负面）。

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[SHOT_DESCRIPTION]]` | 分镜描述 | "小明坐在靠窗位置看书" |
| `[[CHARACTERS]]` | 涉及角色及其描述 | "小明: 黑色短发，戴眼镜" |
| `[[SCENE_REF]]` | 场景参考描述 | "图书馆内，阳光充足" |
| `[[STYLE]]` | 整体风格描述 | "日系动漫风格，新海诚风格" |

**LLM应返回格式：**
```json
{
  "positive": "详细的正面提示词",
  "negative": "负面提示词，如：bad anatomy, bad hands..."
}
```

#### 视频提示词模板 (video_prompt)

用于指导LLM生成每个分镜的视频描述。

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `[[SCENE_DESCRIPTION]]` | 剧本场景描述 | "图书馆内，阳光透过窗户洒进来" |
| `[[IMAGE_PROMPT]]` | 首帧图片提示词 | "日系动漫风格，黑发少年坐在窗边..." |
| `[[CHARACTERS]]` | 角色信息 | "- 小明: 黑发少年，戴眼镜，白色T恤" |
| `[[ACTION]]` | 分镜动作描述 | "小明翻书页，抬头看向门口" |
| `[[CAMERA_MOVEMENT]]` | 镜头运动 | "static" / "pan" / "zoom" 等 |
| `[[DURATION]]` | 持续时间 | "5s" |

**LLM应返回：** 视频描述文本（50-100字）

---

## 使用示例

### 角色提取提示词示例
```yaml
character_extraction: |
  请从以下剧本中提取所有主要角色信息。
  
  剧本内容：
  [[SCRIPT]]
  
  请以JSON格式输出角色列表。
```

### 分镜设计提示词示例
```yaml
shot_design: |
  你是一名专业的分镜师。请为以下场景设计分镜。
  
  场景信息：
  - 场景名称: [[SCENE_NAME]]
  - 场景描述: [[SCENE_DESCRIPTION]]
  - 涉及角色: [[CHARACTERS]]
  
  剧本片段：
  [[SCRIPT_SEGMENT]]
  
  请设计3-5个分镜...
```

### 视频提示词示例
```yaml
video_prompt: |
  基于以下信息生成视频生成提示词。
  
  剧本场景描述: [[SCENE_DESCRIPTION]]
  首帧图片提示词: [[IMAGE_PROMPT]]
  角色信息: [[CHARACTERS]]
  分镜动作描述: [[ACTION]]
  镜头运动: [[CAMERA_MOVEMENT]]
  持续时间: [[DURATION]]
  
  请生成一个详细的视频描述，包含：
  1. 画面主体的动作描述
  2. 相机运动方式
  3. 光影变化（如果有）
```

---

## 前端界面占位符说明

系统在各提示词编辑界面都提供了占位符说明：

| 页面 | 编辑入口 | 占位符说明位置 |
|------|----------|----------------|
| 剧本解析 (ScriptParse.vue) | "编辑提示词" 按钮 | Tooltip + Placeholder |
| 参考图 (References.vue) | "编辑提示词" 按钮 | Tooltip + Placeholder |
| 分镜设计 (Shots.vue) | "编辑提示词" 按钮 | Tooltip + Placeholder |
| 首帧生成 (Keyframes.vue) | "编辑提示词" 按钮 | Tooltip + Placeholder |
| 视频生成 (Videos.vue) | 视频Prompt编辑区域 | Descriptions 组件 |

---

## 注意事项

1. **大小写敏感**：占位符变量名区分大小写，如 `[[SCRIPT]]` 不能写作 `[[script]]`

2. **双括号格式**：必须使用双括号 `[[...]]`，不要使用单括号或花括号

3. **可选变量**：某些变量可能为空（如角色性格），后端会自动处理为空的情况

4. **自定义提示词**：用户可在设置页面自定义各阶段提示词模板，系统会自动替换占位符

5. **调试技巧**：如果占位符未被替换，请检查：
   - 占位符拼写是否正确
   - 是否使用了双括号格式
   - 对应数据是否存在（如未设置风格描述，`[[STYLE]]`会被替换为空字符串）
