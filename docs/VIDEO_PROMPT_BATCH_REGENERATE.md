# 视频Prompt批量重新生成功能

## 功能概述

在视频生成页面添加了批量重新生成视频Prompt的功能，支持多选/全选操作。

## 新增功能

### 1. 全选操作栏

当没有选择任何分镜时，显示全选操作栏：
- **全选** - 选择所有分镜
- **选择有Prompt的** - 只选择已有视频Prompt的分镜
- **选择无Prompt的** - 只选择没有视频Prompt的分镜

### 2. 批量操作栏增强

当选择了分镜后，显示批量操作栏：
- **生成视频Prompt** - 只为没有Prompt的分镜生成（保留已有Prompt）
- **重新生成** - 为所有选中的分镜重新生成Prompt（覆盖已有）
- **生成视频** - 批量生成视频
- **批量下载** - 下载已完成的视频
- **取消选择** - 清空选择

### 3. 智能提示

- 当选择的分镜都已存在Prompt时，点击"生成视频Prompt"会提示用户使用"重新生成"按钮
- 重新生成前会显示确认对话框，防止误操作
- 批量操作完成后显示成功/失败统计

## 使用方法

### 场景1：为没有Prompt的分镜生成

1. 点击"选择无Prompt的"快速选择需要生成分镜
2. 点击"生成视频Prompt"按钮
3. 系统会自动过滤掉已有Prompt的分镜

### 场景2：重新生成所有Prompt

1. 点击"全选"选择所有分镜
2. 点击"重新生成"按钮
3. 确认对话框中点击"确定"
4. 系统会为所有选中的分镜重新生成Prompt

### 场景3：只重新生成部分Prompt

1. 手动勾选需要重新生成的分镜（使用卡片上的复选框）
2. 点击"重新生成"按钮
3. 确认后执行

## 界面预览

```
┌─────────────────────────────────────────────────────────────┐
│ 视频生成                                        [编辑模板]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 全选 (10个)   选择有Prompt的 (5个)   选择无Prompt的 (5个)│  │  ← 全选操作栏
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  或选择分镜后显示：                                          │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ℹ️ 已选择 5 个分镜                                     │   │
│  │                                                       │   │
│  │ [生成视频Prompt] [重新生成] [生成视频] [批量下载] [取消] │  │  ← 批量操作栏
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ ☑️          │  │ ☑️          │  │ ☑️          │         │
│  │  ┌───────┐  │  │  ┌───────┐  │  │  ┌───────┐  │         │
│  │  │ 首帧  │  │  │  │ 首帧  │  │  │  │ 首帧  │  │         │
│  │  │ 图片  │  │  │  │ 图片  │  │  │  │ 图片  │  │         │
│  │  └───────┘  │  │  └───────┘  │  │  └───────┘  │         │
│  │             │  │             │  │             │         │
│  │ shot_001    │  │ shot_002    │  │ shot_003    │         │
│  │ [生成] [编辑]│  │ [生成] [编辑]│  │ [生成] [编辑]│         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 技术实现

### 新增方法

```javascript
// 选择相关
selectAll()                    // 全选所有分镜
selectAllWithPrompt()          // 选择有Prompt的分镜
selectAllWithoutPrompt()       // 选择无Prompt的分镜

// 生成相关
generateVideoPromptsForSelected()      // 生成Prompt（只生成没有的）
regenerateVideoPromptsForSelected()    // 重新生成Prompt（覆盖已有）
```

### 状态管理

```javascript
generatingPrompt.value      // 'batch' 表示正在生成
regeneratingPrompt.value    // 'batch' 表示正在重新生成
```

## 错误处理

- 单个分镜生成失败不会影响其他分镜
- 显示成功和失败的统计数量
- 网络错误会提示用户重试

## 注意事项

1. 重新生成会覆盖已有的视频Prompt
2. 生成视频前请确保已生成视频Prompt
3. 批量下载只包含已完成的视频
